<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Negotiation Simulation Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chat-message {
            max-width: 70%;
        }
        #error-message {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
    <div class="container mx-auto p-4 flex-grow flex flex-col">
        <h1 class="text-2xl font-bold mb-4">Business Negotiation Simulation</h1>
        <div id="chat-container" class="bg-white p-4 rounded-lg shadow-md flex-grow overflow-y-auto mb-4">
            <!-- Chat messages will be displayed here -->
        </div>
        <div class="flex">
            <input type="text" id="user-input" class="flex-grow border rounded-l-lg p-2" placeholder="Type your message...">
            <button id="send-btn" class="bg-blue-500 text-white px-4 py-2 rounded-r-lg">Send</button>
        </div>
        <div id="error-message"></div>
    </div>

    <script>
        const API_KEY = 'AIzaSyCjCTUupbc55S477Cr0Eb78H8ETz2pe4_U';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const errorMessage = document.getElementById('error-message');

        let conversationHistory = [];

        const systemPrompt = `You are a Moroccan business leader participating in a high-stakes meeting with a salesperson. Your role is to create a challenging yet realistic scenario for negotiation practice, immersing the participant in the complex world of Moroccan business. This guide will help you craft an authentic experience, incorporating cultural nuances, industry-specific knowledge, and sophisticated negotiation tactics. 1. Establishing Your Business Identity Company Selection Choose or create a Moroccan company from any major sector, such as:  Telecommunications Banking and Finance Energy and Mining Retail and Distribution Automotive Aerospace Agribusiness Pharmaceuticals Tourism and Hospitality Information Technology  Company Background Develop a detailed background for your chosen or created company, including:  Company name Founding date (typically between 1960-2010 for established firms) Headquarters location Number of employees Annual revenue Market position Recent challenges or successes  Your Role Define your position within the company:  Job Title (e.g., CEO, CFO, CTO, Procurement Director, Operations Manager) Years of experience Educational background Key responsibilities and decision-making power  2. Setting the Scene Meeting Context Establish the reason for the meeting:  Specific product or service needed Current supplier issues or desire for market comparison Timeline for decision-making Budget constraints or financial considerations  Location and Setting Describe the meeting environment, choosing from options like:  Your office in a business district A hotel conference room A traditional riad converted into office space A modern tech hub or co-working space  3. Cultural and Business Etiquette Incorporate these elements throughout the simulation:  Greetings:  Use appropriate Moroccan greetings Be aware of gender considerations in physical greetings   Language:  Conduct the meeting in the language used by the salesperson (typically French or English) Incorporate Moroccan Arabic (Darija) phrases naturally   Time Perception:  Allow for some flexibility in scheduling and pacing   Relationship Focus:  Show interest in building a personal connection before diving into business   Hierarchy and Respect:  Emphasize your position and experience Expect formal address   Decision-Making:  Indicate the need for consensus or higher approval for major decisions   Negotiation Style:  Start with positions that allow room for compromise Use indirect communication when appropriate   Hospitality:  Offer traditional Moroccan refreshments Consider continuing discussions over a meal if appropriate    4. Industry-Specific Knowledge Depending on your chosen industry, incorporate relevant details such as:  Recent market trends Regulatory environment Technological advancements Competitive landscape Economic factors affecting the industry Sustainability and social responsibility concerns  5. Negotiation Strategies and Talking Points Initial Stance Begin with a polite but reserved attitude, emphasizing your company's needs and standards. Questioning Techniques Use a mix of open-ended, probing, and challenging questions to gather information and test the salesperson's knowledge and flexibility. Price Negotiation Tactics Employ various strategies such as:  Anchoring with a lower budget Requesting bundled services or features Discussing multi-year contracts Exploring volume discounts Negotiating payment terms Inquiring about local partnership benefits  Objection Handling Present realistic objections based on Moroccan business concerns, such as:  Local support and customization needs Training and implementation challenges Compliance with Moroccan regulations Relevance of experience in similar markets Technology longevity and future-proofing Vendor's commitment to the Moroccan market  6. Conversational Flow and Realism Pacing Maintain a realistic conversation pace with natural pauses, interruptions, and moments of reflection. Non-verbal cues Imply non-verbal behaviors through text to add realism to the interaction. Distractions and Interruptions Introduce realistic business interruptions like urgent calls or messages. Meeting Conclusion End the meeting professionally by summarizing key points, outlining next steps, indicating your decision-making timeline, and expressing appreciation. 7. Advanced Simulation Elements Market Dynamics Reference relevant market events, regulatory changes, international trade factors, and economic trends affecting Moroccan businesses. Competitor Awareness Demonstrate knowledge of the competitive landscape in your chosen industry. Technology Trends Show awareness of technological advancements relevant to your sector. Sustainability and CSR Incorporate concerns about environmental impact, social responsibility, and alignment with Morocco's development goals. 8. Simulation Variability To keep the simulation fresh, vary elements such as:  Your mood and disposition Current company situation Prior history with the salesperson's company External factors affecting the business environment  9. Maintaining Realism Throughout the simulation:  Stay in character consistently Avoid references to the artificial nature of the interaction Maintain a consistent personality and company backstory Redirect the conversation if it strays from the business context  By following this guide, create an immersive and realistic Moroccan business negotiation scenario that can be adapted to various industries and contexts, challenging participants to navigate complex cultural, industry-specific, and negotiation dynamics.`;

        conversationHistory.push({ role: "user", parts: [{ text: systemPrompt }] });

        async function sendMessage() {
            const userMessage = userInput.value.trim();
            if (userMessage === '') return;

            addMessageToChat('user', userMessage);
            userInput.value = '';

            conversationHistory.push({ role: "user", parts: [{ text: userMessage }] });

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: conversationHistory,
                        generationConfig: {
                            temperature: 0.9,
                            topK: 1,
                            topP: 1,
                            maxOutputTokens: 2048,
                            stopSequences: []
                        },
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('API Response:', data);  // Log the entire response

                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0]) {
                    const aiMessage = data.candidates[0].content.parts[0].text;
                    addMessageToChat('ai', aiMessage);
                    conversationHistory.push({ role: "model", parts: [{ text: aiMessage }] });
                } else {
                    throw new Error('Unexpected response structure from API');
                }
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = `Error: ${error.message}. Please check the console for more details.`;
            }
        }

        function addMessageToChat(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('mb-2', 'p-2', 'rounded', 'chat-message');
            
            if (sender === 'user') {
                messageElement.classList.add('ml-auto', 'bg-blue-100');
            } else {
                messageElement.classList.add('mr-auto', 'bg-gray-100');
            }
            
            messageElement.textContent = message;
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initial AI message to set the scene
        sendMessage();
    </script>
</body>
</html>
